<% if alert = flash[:alert] %>
  <p class="py-2 px-3 bg-red-50 mb-5 text-red-500 font-medium rounded-lg inline-block" id="alert"><%= alert %></p>
<% end %>

<% if notice = flash[:notice] %>
  <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-lg inline-block" id="notice"><%= notice %></p>
<% end %>
<div class="grid grid-cols-1 gap-x-8 gap-y-8 py-10 md:grid-cols-3">

  <div class="px-4 sm:px-0">
    <h2 class="text-base/7 font-semibold text-gray-900">Update Personal Information</h2>
    <p class="mt-1 text-sm/6 text-gray-600">The Information will only be seen by an admin and not shared publicly.</p>
  </div>

  <!--  SEE ERRORS AT TOP-->
  <%= form_with model: Current.user, url: settings_profile_path, class: "bg-white ring-1 shadow-xs ring-gray-900/5 sm:rounded-xl md:col-span-2" do |f| %>
    <% if f.object.errors.any? %>
      <div>
        <% f.object.errors.full_messages.each do |message| %>
          <p class="py-2 px-3 bg-indigo-50 mb-5 text-red-500 font-medium rounded-md inline-block" id="notice"><%= message %></p>
        <% end %>
      </div>
    <% end %>
    <!--    FIRST NAME-->
    <div class="px-4 py-6 sm:p-8">
      <div class="grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
        <div class="sm:col-span-3">
          <label for="first-name" class="block text-sm/6 font-medium text-gray-900">First name</label>
          <div class="mt-2">
            <%= f.text_field :first_name, class: "block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6" %>
          </div>
        </div>

        <!--          LAST NAME-->
        <div class="sm:col-span-3">
          <label for="last-name" class="block text-sm/6 font-medium text-gray-900">Last name</label>
          <div class="mt-2">
            <%= f.text_field :last_name, class: "block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6" %>
          </div>
        </div>

        <!--          SECTION-->
        <div class="sm:col-span-4">
          <label for="year_section" class="block text-sm/6 font-medium text-gray-900">Section</label>
          <div class="mt-2">
            <%= f.text_field :year_section, class: "block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6" %>
          </div>
        </div>

        <!--          EMAIL-->
        <div class="sm:col-span-4">
          <label for="email" class="block text-sm/6 font-medium text-gray-900">Institutional Email</label>
          <div class="mt-2">
            <%= f.email_field :institutional_email, class: "block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6" %>
          </div>
        </div>

        <!--          IMAGE CIRCLE-->
        <div class="col-span-full">
          <label class="block text-sm/6 font-medium text-gray-900">Photo</label>

          <div class="mt-2 flex items-center gap-x-3">
            <!-- Preview image (replace svg when file selected) -->
            <img
              id="profile-preview"
              class="size-12 rounded-full object-cover hidden"
              alt="Profile preview"
            >

            <!-- Default icon -->
            <!--            <svg-->
            <!--              id="profile-icon"-->
            <!--              class="size-12 text-gray-300"-->
            <!--              viewBox="0 0 24 24"-->
            <!--              fill="currentColor"-->
            <!--              aria-hidden="true">-->
            <!--              <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Z" clip-rule="evenodd"/>-->
            <!--            </svg>-->
            <%= image_tag Current.user.profile, id: "profile-icon", class: "size-12 text-gray-300 rounded-3xl" %>


            <!-- Label triggers file input -->
            <%= f.label :profile, "Change",
                        class: "cursor-pointer rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 ring-1 shadow-xs ring-gray-300 ring-inset hover:bg-gray-50" %>

            <!-- Hidden file input -->
            <%= f.file_field :profile,
                             class: "hidden",
                             accept: "image/*",
                             onchange: "previewProfileImage(event)" %>
          </div>
        </div>
        <%= link_to "Change Password", settings_password_path, class: "rounded-md bg-blue-500 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-blue-800 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600" %>
        <%= link_to "Delete Account", settings_user_path, class: "rounded-md bg-red-500 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-red-800 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600" %>
      </div>
    </div>
    </div>

    <!--    CANCEL AND SUBMIT-->
    <div class="flex items-center justify-end gap-x-6 border-t border-gray-900/10 px-4 py-4 sm:px-8">
      <%= link_to "Cancel", new_session_path, class: "text-sm/6 font-semibold text-gray-900" %>
      <div class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
        <%= f.submit %>
      </div>
    </div>
  <% end %>

  <!--IMAGE PREVIEW SCRIPT-->
  <script>
      window.previewProfileImage = function (event) {
          const input = event.target
          const file = input.files[0]
          if (!file) return

          const preview = document.getElementById("profile-preview")
          const icon = document.getElementById("profile-icon")

          preview.src = URL.createObjectURL(file)
          preview.classList.remove("hidden")
          icon.classList.add("hidden")
      }
  </script>
